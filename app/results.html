<!DOCTYPE html>
<html>
	<head>
		<title>Longview Hackathon Example App : Results</title>
		<link type="text/css" rel="stylesheet" href="style.css" />
		<script>
		function fetchData() {
			var authorizationToken = window.localStorage.getItem('token');
			if (!authorizationToken) { window.location.href = '/'; }
			function requestCallback() {
				var user = JSON.parse(this.responseText)['ns3:userSession']['ns3:mhpuser'];
				document.querySelector('#displayName').textContent = user.displayName;
				document.querySelector('#firstName').textContent = user.firstName;
				document.querySelector('#lastName').textContent = user.lastName;
				document.querySelector('#facilityName').textContent = user.facilityName;
				document.querySelector('#dfn').textContent = user.userIdentifier.assigningAuthority;
			}
			var xhr = new XMLHttpRequest();
			xhr.open('GET', '/service/' + encodeURIComponent('MobileHealthPlatformWeb/rest/user-session'));
			xhr.setRequestHeader('Authorization', 'Bearer ' + authorizationToken);
			xhr.onload = requestCallback;
			xhr.send();
		}
		</script>
	</head>

	<body onload="fetchData()">
		<h1>Congratulations!</h1>
		<h2>Logged in as:</h2>
		<div id="user-info">
			<div><span class="label">Display Name</span> <span id="displayName"></span></div>
			<div><span class="label">Name</span> <span id="lastName"></span>, <span id="firstName"></span></div>
			<div><span class="label">Facility Name</span> <span id="facilityName"></span></div>
			<div><span class="label">DFN</span> <span id="dfn"></span></div>
		</div>
	</body>
</html>